{% extends "base.html" %}
{% block title %}–î–∞—à–±–æ—Ä–¥{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6">

  <!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
  <div class="flex items-center justify-between mb-8 bg-white shadow rounded-lg p-4">
    <div class="flex items-center">
      <img src="https://ui-avatars.com/api/?name={{ user.get_full_name }}" alt="avatar"
           class="w-14 h-14 rounded-full shadow mr-4">
      <div>
        <h1 class="text-xl font-bold text-gray-800">üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.get_full_name }}</h1>
        <p class="text-sm text-gray-500">–†–æ–ª—å: {{ user.role|title }}</p>
      </div>
    </div>
    <form action="{% url 'logout' %}" method="post">
      {% csrf_token %}
      <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition">–í—ã–π—Ç–∏</button>
    </form>
  </div>

  <!-- –°–æ–≤–µ—Ç –¥–Ω—è -->
  <div class="bg-purple-100 p-4 rounded-lg shadow mb-8">
    <p class="font-semibold text-purple-800">üí° –°–æ–≤–µ—Ç –¥–Ω—è:</p>
    <p class="text-sm text-purple-600">–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å —è–≤–∫—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –∑–∞–±—ã–ª–∏ –ª–∏ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ –æ—Ç–ø—É—Å–∫.</p>
  </div>

  {% if user.role == 'worker' %}
    <!-- –ë–ª–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
      <div class="p-5 bg-green-100 rounded-xl shadow text-center">
        <p class="text-gray-600">‚úÖ –û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ</p>
        <p class="text-3xl font-bold text-green-700">{{ worked_days }}</p>
      </div>
      <div class="p-5 bg-blue-100 rounded-xl shadow text-center">
        <p class="text-gray-600">üèñÔ∏è –û—Ç–ø—É—Å–∫</p>
        <p class="text-3xl font-bold text-blue-700">{{ vacation_days }}</p>
      </div>
      <div class="p-5 bg-yellow-100 rounded-xl shadow text-center">
        <p class="text-gray-600">ü§í –ë–æ–ª—å–Ω–∏—á–Ω—ã–π</p>
        <p class="text-3xl font-bold text-yellow-700">{{ sick_days }}</p>
      </div>
      <div class="p-5 bg-red-100 rounded-xl shadow text-center">
        <p class="text-gray-600">‚õî –ü—Ä–æ–ø—É—â–µ–Ω–æ</p>
        <p class="text-3xl font-bold text-red-700">{{ absent_days }}</p>
      </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
      <a href="{% url 'attendance' %}" class="py-4 bg-indigo-500 hover:bg-indigo-600 text-white rounded-xl shadow text-center transition">
        üìÖ –ú–æ–π —Ç–∞–±–µ–ª—å
      </a>
      <a href="{% url 'leave_request' %}" class="py-4 bg-teal-500 hover:bg-teal-600 text-white rounded-xl shadow text-center transition">
        üìù –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É
      </a>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏ -->
    <div class="bg-white shadow rounded-lg p-4">
      <h2 class="font-bold text-lg text-gray-700 mb-4">üóÇÔ∏è –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏</h2>
      <ul class="divide-y">
        {% for req in my_requests %}
          <li class="py-3 flex justify-between items-center">
            <span class="text-gray-700">{{ req.get_leave_type_display }}: {{ req.start_date }} ‚Äì {{ req.end_date }}</span>
            <span class="text-sm px-2 py-1 rounded font-medium
              {% if req.status == 'approved' %}bg-green-100 text-green-700
              {% elif req.status == 'rejected' %}bg-red-100 text-red-700
              {% else %}bg-yellow-100 text-yellow-700{% endif %}">
              {% if req.status == 'approved' %}‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ{% elif req.status == 'rejected' %}‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ{% else %}‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏{% endif %}
            </span>
          </li>
        {% empty %}
          <li class="text-gray-500">–ù–µ—Ç –∑–∞—è–≤–æ–∫.</li>
        {% endfor %}
      </ul>
    </div>
  {% elif user.role == 'editor' %}
    <!-- Editor –±–ª–æ–∫ -->
    <div class="mb-8 bg-yellow-100 p-4 rounded-xl shadow">
      <h2 class="text-lg font-semibold text-yellow-700 mb-2">üõ†Ô∏è –ó–∞–¥–∞—á–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h2>
      <p class="text-gray-700">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–µ–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –∑–∞ —Ç–µ–∫—É—â–∏–π –ø–µ—Ä–∏–æ–¥ –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–Ω–µ—Å–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.</p>
    </div>
    <a href="{% url 'edit_attendance' %}" class="py-4 bg-yellow-500 hover:bg-yellow-600 text-white rounded-xl shadow text-center transition block">
      üõ† –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    </a>
  {% elif user.role == 'approver' %}
    <!-- Approver: –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div class="bg-green-100 rounded-lg shadow p-4">
        <h2 class="text-sm text-green-700">‚úÖ –°–µ–≥–æ–¥–Ω—è –Ω–∞ —Ä–∞–±–æ—Ç–µ</h2>
        <p class="text-3xl font-bold text-green-800">{{ stats.today_present }}/{{ stats.total_employees }}</p>
      </div>
      <div class="bg-yellow-100 rounded-lg shadow p-4">
        <h2 class="text-sm text-yellow-700">ü§í –ù–∞ –±–æ–ª—å–Ω–∏—á–Ω–æ–º</h2>
        <p class="text-3xl font-bold text-yellow-800">{{ stats.today_sick }}</p>
      </div>
      <div class="bg-blue-100 rounded-lg shadow p-4">
        <h2 class="text-sm text-blue-700">üèñÔ∏è –í –æ—Ç–ø—É—Å–∫–µ</h2>
        <p class="text-3xl font-bold text-blue-800">{{ stats.today_vacation }}</p>
      </div>
    </div>

    <!-- –ì—Ä–∞—Ñ–∏–∫ -->
    <div class="mb-6 bg-white rounded-lg shadow p-4">
      <h2 class="text-lg font-semibold text-gray-800 mb-4">üìà –û—Ç—á—ë—Ç–Ω–æ—Å—Ç—å –ø–æ —è–≤–∫–µ –∑–∞ –º–µ—Å—è—Ü</h2>
      <canvas id="attendanceChart" height="100"></canvas>
    </div>

    <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
    <div class="bg-white shadow rounded-lg p-4 mb-6">
      <div class="flex justify-between items-center mb-4">
        <h2 class="font-bold text-lg text-gray-700">üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞—è–≤–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
        <a href="{% url 'approve_requests' %}" class="text-sm text-indigo-600 hover:underline">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ ‚Üí</a>
      </div>
      <ul class="divide-y">
        {% for req in team_requests %}
          <li class="py-2 flex justify-between items-center">
            <div>
              <p class="font-medium text-gray-700">{{ req.user.get_full_name }}</p>
              <p class="text-sm text-gray-500">{{ req.get_leave_type_display }}: {{ req.start_date }} ‚Äì {{ req.end_date }}</p>
            </div>
            <span class="text-sm px-2 py-1 rounded font-medium
              {% if req.status == 'approved' %}bg-green-100 text-green-700
              {% elif req.status == 'rejected' %}bg-red-100 text-red-700
              {% else %}bg-yellow-100 text-yellow-700{% endif %}">
              {% if req.status == 'approved' %}‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ{% elif req.status == 'rejected' %}‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ{% else %}‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏{% endif %}
            </span>
          </li>
        {% empty %}
          <li class="text-gray-500">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –æ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.</li>
        {% endfor %}
      </ul>
    </div>

    <!-- –ö–æ–º–∞–Ω–¥–∞ -->
    <div class="bg-white shadow rounded-lg p-4">
      <h2 class="font-bold text-lg text-gray-700 mb-4">üë• –ö–æ–º–∞–Ω–¥–∞</h2>
      <table class="min-w-full divide-y">
        <thead class="bg-gray-100">
          <tr>
            <th class="px-4 py-2 text-sm text-gray-600">–§–ò–û</th>
            <th class="px-4 py-2 text-sm text-gray-600">–î–æ–ª–∂–Ω–æ—Å—Ç—å</th>
            <th class="px-4 py-2 text-sm text-gray-600">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ</th>
            <th class="px-4 py-2 text-sm text-gray-600">–ë–æ–ª—å–Ω–∏—á–Ω—ã–π</th>
            <th class="px-4 py-2 text-sm text-gray-600">–û—Ç–ø—É—Å–∫</th>
          </tr>
        </thead>
        <tbody>
          {% for member in team_members %}
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-2">{{ member.get_full_name }}</td>
              <td class="px-4 py-2">{{ member.position }}</td>
              <td class="px-4 py-2">{{ member.worked_days }}</td>
              <td class="px-4 py-2">{{ member.sick_days }}</td>
              <td class="px-4 py-2">{{ member.vacation_days }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endif %}
</div>
{% endblock %}
